##
## Exported symobls in package `mime`
##

## Exported package methods

mimemap <- structure(c("application/andrew-inset", "application/annodex", 
"application/atom+xml", "application/atomcat+xml", "application/atomserv+xml", 
"application/bbolin", "application/cu-seeme", "application/davmount+xml", 
"application/dicom", "application/dsptype", "application/ecmascript", 
"application/font-sfnt", "application/font-sfnt", "application/font-tdpfr", 
"application/font-woff", "application/futuresplash", "application/gzip", 
"application/hta", "application/java-archive", "application/java-serialized-object", 
"application/java-vm", "application/javascript", "application/json", 
"application/m3g", "application/mac-binhex40", "application/mac-compactpro", 
"application/mathematica", "application/mathematica", "application/mbox", 
"application/msaccess", "application/msword", "application/msword", 
"application/mxf", "application/octet-stream", "application/oda", 
"application/oebps-package+xml", "application/ogg", "application/onenote", 
"application/onenote", "application/onenote", "application/onenote", 
"application/pdf", "application/pgp-encrypted", "application/pgp-keys", 
"application/pgp-signature", "application/pics-rules", "application/postscript", 
"application/postscript", "application/postscript", "application/postscript", 
"application/postscript", "application/postscript", "application/postscript", 
"application/rar", "application/rdf+xml", "application/rtf", 
"application/sla", "application/smil+xml", "application/smil+xml", 
"application/xhtml+xml", "application/xhtml+xml", "application/xml", 
"application/xml", "application/xslt+xml", "application/xslt+xml", 
"application/xspf+xml", "application/zip", "application/vnd.android.package-archive", 
"application/vnd.cinderella", "application/vnd.debian.binary-package", 
"application/vnd.debian.binary-package", "application/vnd.debian.binary-package", 
"application/vnd.font-fontforge-sfd", "application/vnd.google-earth.kml+xml", 
"application/vnd.google-earth.kmz", "application/vnd.mozilla.xul+xml", 
"application/vnd.ms-excel", "application/vnd.ms-excel", "application/vnd.ms-excel", 
"application/vnd.ms-excel.addin.macroEnabled.12", "application/vnd.ms-excel.sheet.binary.macroEnabled.12", 
"application/vnd.ms-excel.sheet.macroEnabled.12", "application/vnd.ms-excel.template.macroEnabled.12", 
"application/vnd.ms-fontobject", "application/vnd.ms-officetheme", 
"application/vnd.ms-pki.seccat", "application/vnd.ms-powerpoint", 
"application/vnd.ms-powerpoint", "application/vnd.ms-powerpoint.addin.macroEnabled.12", 
"application/vnd.ms-powerpoint.presentation.macroEnabled.12", 
"application/vnd.ms-powerpoint.slide.macroEnabled.12", "application/vnd.ms-powerpoint.slideshow.macroEnabled.12", 
"application/vnd.ms-powerpoint.template.macroEnabled.12", "application/vnd.ms-word.document.macroEnabled.12", 
"application/vnd.ms-word.template.macroEnabled.12", "application/vnd.oasis.opendocument.chart", 
"application/vnd.oasis.opendocument.database", "application/vnd.oasis.opendocument.formula", 
"application/vnd.oasis.opendocument.graphics", "application/vnd.oasis.opendocument.graphics-template", 
"application/vnd.oasis.opendocument.image", "application/vnd.oasis.opendocument.presentation", 
"application/vnd.oasis.opendocument.presentation-template", "application/vnd.oasis.opendocument.spreadsheet", 
"application/vnd.oasis.opendocument.spreadsheet-template", "application/vnd.oasis.opendocument.text", 
"application/vnd.oasis.opendocument.text-master", "application/vnd.oasis.opendocument.text-template", 
"application/vnd.oasis.opendocument.text-web", "application/vnd.openxmlformats-officedocument.presentationml.presentation", 
"application/vnd.openxmlformats-officedocument.presentationml.slide", 
"application/vnd.openxmlformats-officedocument.presentationml.slideshow", 
"application/vnd.openxmlformats-officedocument.presentationml.template", 
"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet", 
"application/vnd.openxmlformats-officedocument.spreadsheetml.template", 
"application/vnd.openxmlformats-officedocument.wordprocessingml.document", 
"application/vnd.openxmlformats-officedocument.wordprocessingml.template", 
"application/vnd.rim.cod", "application/vnd.smaf", "application/vnd.stardivision.calc", 
"application/vnd.stardivision.chart", "application/vnd.stardivision.draw", 
"application/vnd.stardivision.impress", "application/vnd.stardivision.math", 
"application/vnd.stardivision.writer", "application/vnd.stardivision.writer-global", 
"application/vnd.sun.xml.calc", "application/vnd.sun.xml.calc.template", 
"application/vnd.sun.xml.draw", "application/vnd.sun.xml.draw.template", 
"application/vnd.sun.xml.impress", "application/vnd.sun.xml.impress.template", 
"application/vnd.sun.xml.math", "application/vnd.sun.xml.writer", 
"application/vnd.sun.xml.writer.global", "application/vnd.sun.xml.writer.template", 
"application/vnd.symbian.install", "application/vnd.tcpdump.pcap", 
"application/vnd.tcpdump.pcap", "application/vnd.visio", "application/vnd.visio", 
"application/vnd.visio", "application/vnd.visio", "application/vnd.wap.wbxml", 
"application/vnd.wap.wmlc", "application/vnd.wap.wmlscriptc", 
"application/vnd.wordperfect", "application/vnd.wordperfect5.1", 
"application/x-123", "application/x-7z-compressed", "application/x-abiword", 
"application/x-apple-diskimage", "application/x-bcpio", "application/x-bittorrent", 
"application/x-cab", "application/x-cbr", "application/x-cbz", 
"application/x-cdf", "application/x-cdf", "application/x-cdlink", 
"application/x-chess-pgn", "application/x-comsol", "application/x-cpio", 
"application/x-csh", "application/x-director", "application/x-director", 
"application/x-director", "application/x-dms", "application/x-doom", 
"application/x-dvi", "application/x-font", "application/x-font", 
"application/x-font", "application/x-font-pcf", "application/x-font-pcf", 
"application/x-freemind", "application/x-ganttproject", "application/x-gnumeric", 
"application/x-go-sgf", "application/x-graphing-calculator", 
"application/x-gtar", "application/x-gtar-compressed", "application/x-gtar-compressed", 
"application/x-hdf", "application/x-hwp", "application/x-ica", 
"application/x-info", "application/x-internet-signup", "application/x-internet-signup", 
"application/x-iphone", "application/x-iso9660-image", "application/x-jam", 
"application/x-java-jnlp-file", "application/x-jmol", "application/x-kchart", 
"application/x-killustrator", "application/x-koan", "application/x-koan", 
"application/x-koan", "application/x-koan", "application/x-kpresenter", 
"application/x-kpresenter", "application/x-kspread", "application/x-kword", 
"application/x-kword", "application/x-latex", "application/x-lha", 
"application/x-lyx", "application/x-lzh", "application/x-lzx", 
"application/x-maker", "application/x-maker", "application/x-maker", 
"application/x-maker", "application/x-maker", "application/x-maker", 
"application/x-maker", "application/x-mif", "application/x-mpegURL", 
"application/x-ms-wmd", "application/x-ms-wmz", "application/x-msdos-program", 
"application/x-msdos-program", "application/x-msdos-program", 
"application/x-msdos-program", "application/x-msi", "application/x-netcdf", 
"application/x-ns-proxy-autoconfig", "application/x-nwc", "application/x-object", 
"application/x-oz-application", "application/x-pkcs7-certreqresp", 
"application/x-pkcs7-crl", "application/x-python-code", "application/x-python-code", 
"application/x-qgis", "application/x-qgis", "application/x-qgis", 
"application/x-quicktimeplayer", "application/x-rdp", "application/x-redhat-package-manager", 
"application/x-rss+xml", "application/x-ruby", "application/x-scilab", 
"application/x-scilab", "application/x-scilab-xcos", "application/x-sh", 
"application/x-shar", "application/x-shockwave-flash", "application/x-shockwave-flash", 
"application/x-silverlight", "application/x-sql", "application/x-stuffit", 
"application/x-stuffit", "application/x-sv4cpio", "application/x-sv4crc", 
"application/x-tar", "application/x-tcl", "application/x-tex-gf", 
"application/x-tex-pk", "application/x-texinfo", "application/x-texinfo", 
"application/x-trash", "application/x-trash", "application/x-trash", 
"application/x-trash", "application/x-trash", "application/x-troff", 
"application/x-troff", "application/x-troff", "application/x-troff-man", 
"application/x-troff-me", "application/x-troff-ms", "application/x-ustar", 
"application/x-wais-source", "application/x-wingz", "application/x-x509-ca-cert", 
"application/x-xcf", "application/x-xfig", "application/x-xpinstall", 
"application/x-xz", "audio/amr", "audio/amr-wb", "audio/annodex", 
"audio/basic", "audio/basic", "audio/csound", "audio/csound", 
"audio/csound", "audio/flac", "audio/midi", "audio/midi", "audio/midi", 
"audio/mpeg", "audio/mpeg", "audio/mpeg", "audio/mpeg", "audio/mpeg", 
"audio/mpegurl", "audio/ogg", "audio/ogg", "audio/ogg", "audio/ogg", 
"audio/prs.sid", "audio/x-aiff", "audio/x-aiff", "audio/x-aiff", 
"audio/x-gsm", "audio/x-ms-wma", "audio/x-ms-wax", "audio/x-pn-realaudio", 
"audio/x-pn-realaudio", "audio/x-pn-realaudio", "audio/x-scpls", 
"audio/x-sd2", "audio/x-wav", "chemical/x-alchemy", "chemical/x-cache", 
"chemical/x-cache", "chemical/x-cache-csf", "chemical/x-cactvs-binary", 
"chemical/x-cactvs-binary", "chemical/x-cactvs-binary", "chemical/x-cdx", 
"chemical/x-cerius", "chemical/x-chem3d", "chemical/x-chemdraw", 
"chemical/x-cif", "chemical/x-cmdf", "chemical/x-cml", "chemical/x-compass", 
"chemical/x-crossfire", "chemical/x-csml", "chemical/x-csml", 
"chemical/x-ctx", "chemical/x-cxf", "chemical/x-cxf", "chemical/x-embl-dl-nucleotide", 
"chemical/x-embl-dl-nucleotide", "chemical/x-galactic-spc", "chemical/x-gamess-input", 
"chemical/x-gamess-input", "chemical/x-gamess-input", "chemical/x-gaussian-checkpoint", 
"chemical/x-gaussian-checkpoint", "chemical/x-gaussian-cube", 
"chemical/x-gaussian-input", "chemical/x-gaussian-input", "chemical/x-gaussian-input", 
"chemical/x-gaussian-log", "chemical/x-gcg8-sequence", "chemical/x-genbank", 
"chemical/x-hin", "chemical/x-isostar", "chemical/x-isostar", 
"chemical/x-jcamp-dx", "chemical/x-jcamp-dx", "chemical/x-kinemage", 
"chemical/x-macmolecule", "chemical/x-macromodel-input", "chemical/x-macromodel-input", 
"chemical/x-mdl-molfile", "chemical/x-mdl-rdfile", "chemical/x-mdl-rxnfile", 
"chemical/x-mdl-sdfile", "chemical/x-mdl-tgf", "chemical/x-mmcif", 
"chemical/x-mol2", "chemical/x-molconn-Z", "chemical/x-mopac-graph", 
"chemical/x-mopac-input", "chemical/x-mopac-input", "chemical/x-mopac-input", 
"chemical/x-mopac-input", "chemical/x-mopac-out", "chemical/x-mopac-vib", 
"chemical/x-ncbi-asn1", "chemical/x-ncbi-asn1-ascii", "chemical/x-ncbi-asn1-ascii", 
"chemical/x-ncbi-asn1-binary", "chemical/x-ncbi-asn1-binary", 
"chemical/x-pdb", "chemical/x-rosdal", "chemical/x-swissprot", 
"chemical/x-vamas-iso14976", "chemical/x-vmd", "chemical/x-xtel", 
"chemical/x-xyz", "image/gif", "image/ief", "image/jp2", "image/jp2", 
"image/jpeg", "image/jpeg", "image/jpeg", "image/jpm", "image/jpx", 
"image/jpx", "image/pcx", "image/png", "image/svg+xml", "image/svg+xml", 
"image/tiff", "image/tiff", "image/vnd.djvu", "image/vnd.djvu", 
"image/vnd.microsoft.icon", "image/vnd.wap.wbmp", "image/x-canon-cr2", 
"image/x-canon-crw", "image/x-cmu-raster", "image/x-coreldraw", 
"image/x-coreldrawpattern", "image/x-coreldrawtemplate", "image/x-epson-erf", 
"image/x-jg", "image/x-jng", "image/x-ms-bmp", "image/x-nikon-nef", 
"image/x-olympus-orf", "image/x-photoshop", "image/x-portable-anymap", 
"image/x-portable-bitmap", "image/x-portable-graymap", "image/x-portable-pixmap", 
"image/x-rgb", "image/x-xbitmap", "image/x-xpixmap", "image/x-xwindowdump", 
"message/rfc822", "model/iges", "model/iges", "model/mesh", "model/mesh", 
"model/mesh", "model/vrml", "model/vrml", "model/x3d+vrml", "model/x3d+xml", 
"model/x3d+binary", "text/cache-manifest", "text/calendar", "text/calendar", 
"text/css", "text/csv", "text/h323", "text/html", "text/html", 
"text/html", "text/iuls", "text/mathml", "text/plain", "text/plain", 
"text/plain", "text/plain", "text/plain", "text/plain", "text/richtext", 
"text/scriptlet", "text/scriptlet", "text/texmacs", "text/tab-separated-values", 
"text/turtle", "text/vcard", "text/vcard", "text/vnd.sun.j2me.app-descriptor", 
"text/vnd.wap.wml", "text/vnd.wap.wmlscript", "text/x-bibtex", 
"text/x-boo", "text/x-c++hdr", "text/x-c++hdr", "text/x-c++hdr", 
"text/x-c++hdr", "text/x-c++src", "text/x-c++src", "text/x-c++src", 
"text/x-c++src", "text/x-chdr", "text/x-component", "text/x-csrc", 
"text/x-dsrc", "text/x-diff", "text/x-diff", "text/x-haskell", 
"text/x-java", "text/x-lilypond", "text/x-literate-haskell", 
"text/x-moc", "text/x-pascal", "text/x-pascal", "text/x-pcs-gcd", 
"text/x-perl", "text/x-perl", "text/x-python", "text/x-scala", 
"text/x-setext", "text/x-sfv", "text/x-tcl", "text/x-tex", "text/x-tex", 
"text/x-tex", "text/x-tex", "text/x-vcalendar", "video/3gpp", 
"video/annodex", "video/dl", "video/dv", "video/dv", "video/fli", 
"video/gl", "video/mpeg", "video/mpeg", "video/mpeg", "video/MP2T", 
"video/mp4", "video/quicktime", "video/quicktime", "video/ogg", 
"video/webm", "video/vnd.mpegurl", "video/x-flv", "video/x-la-asf", 
"video/x-la-asf", "video/x-mng", "video/x-ms-asf", "video/x-ms-asf", 
"video/x-ms-wm", "video/x-ms-wmv", "video/x-ms-wmx", "video/x-ms-wvx", 
"video/x-msvideo", "video/x-sgi-movie", "video/x-matroska", "video/x-matroska", 
"x-conference/x-cooltalk", "x-epoc/x-sisx-app", "x-world/x-vrml"
), .Names = c("ez", "anx", "atom", "atomcat", "atomsrv", "lin", 
"cu", "davmount", "dcm", "tsp", "es", "otf", "ttf", "pfr", "woff", 
"spl", "gz", "hta", "jar", "ser", "class", "js", "json", "m3g", 
"hqx", "cpt", "nb", "nbp", "mbox", "mdb", "doc", "dot", "mxf", 
"bin", "oda", "opf", "ogx", "one", "onetoc2", "onetmp", "onepkg", 
"pdf", "pgp", "key", "sig", "prf", "ps", "ai", "eps", "epsi", 
"epsf", "eps2", "eps3", "rar", "rdf", "rtf", "stl", "smi", "smil", 
"xhtml", "xht", "xml", "xsd", "xsl", "xslt", "xspf", "zip", "apk", 
"cdy", "deb", "ddeb", "udeb", "sfd", "kml", "kmz", "xul", "xls", 
"xlb", "xlt", "xlam", "xlsb", "xlsm", "xltm", "eot", "thmx", 
"cat", "ppt", "pps", "ppam", "pptm", "sldm", "ppsm", "potm", 
"docm", "dotm", "odc", "odb", "odf", "odg", "otg", "odi", "odp", 
"otp", "ods", "ots", "odt", "odm", "ott", "oth", "pptx", "sldx", 
"ppsx", "potx", "xlsx", "xltx", "docx", "dotx", "cod", "mmf", 
"sdc", "sds", "sda", "sdd", "sdf", "sdw", "sgl", "sxc", "stc", 
"sxd", "std", "sxi", "sti", "sxm", "sxw", "sxg", "stw", "sis", 
"cap", "pcap", "vsd", "vst", "vsw", "vss", "wbxml", "wmlc", "wmlsc", 
"wpd", "wp5", "wk", "7z", "abw", "dmg", "bcpio", "torrent", "cab", 
"cbr", "cbz", "cdf", "cda", "vcd", "pgn", "mph", "cpio", "csh", 
"dcr", "dir", "dxr", "dms", "wad", "dvi", "pfa", "pfb", "gsf", 
"pcf", "pcf.Z", "mm", "gan", "gnumeric", "sgf", "gcf", "gtar", 
"tgz", "taz", "hdf", "hwp", "ica", "info", "ins", "isp", "iii", 
"iso", "jam", "jnlp", "jmz", "chrt", "kil", "skp", "skd", "skt", 
"skm", "kpr", "kpt", "ksp", "kwd", "kwt", "latex", "lha", "lyx", 
"lzh", "lzx", "frm", "maker", "frame", "fm", "fb", "book", "fbdoc", 
"mif", "m3u8", "wmd", "wmz", "com", "exe", "bat", "dll", "msi", 
"nc", "pac", "nwc", "o", "oza", "p7r", "crl", "pyc", "pyo", "qgs", 
"shp", "shx", "qtl", "rdp", "rpm", "rss", "rb", "sci", "sce", 
"xcos", "sh", "shar", "swf", "swfl", "scr", "sql", "sit", "sitx", 
"sv4cpio", "sv4crc", "tar", "tcl", "gf", "pk", "texinfo", "texi", 
"~", "%", "bak", "old", "sik", "t", "tr", "roff", "man", "me", 
"ms", "ustar", "src", "wz", "crt", "xcf", "fig", "xpi", "xz", 
"amr", "awb", "axa", "au", "snd", "csd", "orc", "sco", "flac", 
"mid", "midi", "kar", "mpga", "mpega", "mp2", "mp3", "m4a", "m3u", 
"oga", "ogg", "opus", "spx", "sid", "aif", "aiff", "aifc", "gsm", 
"wma", "wax", "ra", "rm", "ram", "pls", "sd2", "wav", "alc", 
"cac", "cache", "csf", "cbin", "cascii", "ctab", "cdx", "cer", 
"c3d", "chm", "cif", "cmdf", "cml", "cpa", "bsd", "csml", "csm", 
"ctx", "cxf", "cef", "emb", "embl", "spc", "inp", "gam", "gamin", 
"fch", "fchk", "cub", "gau", "gjc", "gjf", "gal", "gcg", "gen", 
"hin", "istr", "ist", "jdx", "dx", "kin", "mcm", "mmd", "mmod", 
"mol", "rd", "rxn", "sd", "tgf", "mcif", "mol2", "b", "gpt", 
"mop", "mopcrt", "mpc", "zmt", "moo", "mvb", "asn", "prt", "ent", 
"val", "aso", "pdb", "ros", "sw", "vms", "vmd", "xtel", "xyz", 
"gif", "ief", "jp2", "jpg2", "jpeg", "jpg", "jpe", "jpm", "jpx", 
"jpf", "pcx", "png", "svg", "svgz", "tiff", "tif", "djvu", "djv", 
"ico", "wbmp", "cr2", "crw", "ras", "cdr", "pat", "cdt", "erf", 
"art", "jng", "bmp", "nef", "orf", "psd", "pnm", "pbm", "pgm", 
"ppm", "rgb", "xbm", "xpm", "xwd", "eml", "igs", "iges", "msh", 
"mesh", "silo", "wrl", "vrml", "x3dv", "x3d", "x3db", "appcache", 
"ics", "icz", "css", "csv", "323", "html", "htm", "shtml", "uls", 
"mml", "asc", "txt", "text", "pot", "brf", "srt", "rtx", "sct", 
"wsc", "tm", "tsv", "ttl", "vcf", "vcard", "jad", "wml", "wmls", 
"bib", "boo", "h++", "hpp", "hxx", "hh", "c++", "cpp", "cxx", 
"cc", "h", "htc", "c", "d", "diff", "patch", "hs", "java", "ly", 
"lhs", "moc", "p", "pas", "gcd", "pl", "pm", "py", "scala", "etx", 
"sfv", "tk", "tex", "ltx", "sty", "cls", "vcs", "3gp", "axv", 
"dl", "dif", "dv", "fli", "gl", "mpeg", "mpg", "mpe", "ts", "mp4", 
"qt", "mov", "ogv", "webm", "mxu", "flv", "lsf", "lsx", "mng", 
"asf", "asx", "wm", "wmv", "wmx", "wvx", "avi", "movie", "mpv", 
"mkv", "ice", "sisx", "vrm"))


guess_type <- function (file, unknown = "application/octet-stream", empty = "text/plain", 
    mime_extra = mimeextra, subtype = "") 
{
    file = basename(file)
    file = tools::file_ext(file)
    type = unname(c(mime_extra, mimemap)[tolower(file)])
    type[file == ""] = empty
    type[is.na(type)] = unknown
    if (any(i <- subtype != "")) {
        if (length(type) != length(file)) 
            stop("'subtype' must be of the same length as 'file'")
        type[i] = paste(type[i], subtype[i], sep = "; ")
    }
    type
}


parse_multipart <- function (env) 
{
    ctype = env$CONTENT_TYPE
    if (length(grep("^multipart", ctype)) == 0L) 
        return()
    EOL = "\r\n"
    params = list()
    input = env$rook.input
    input$rewind()
    content_length = as.integer(env$CONTENT_LENGTH)
    boundary = gsub("^multipart/.*boundary=\"?([^\";,]+)\"?", 
        "--\\1", ctype)
    bytesize = function(x) nchar(x, type = "bytes")
    EOL_size = bytesize(EOL)
    EOL_raw = charToRaw(EOL)
    boundary_size = bytesize(boundary)
    boundaryEOL = paste(boundary, EOL, sep = "")
    boundaryEOL_size = boundary_size + bytesize(EOL)
    boundaryEOL_raw = charToRaw(boundaryEOL)
    EOLEOL = paste(EOL, EOL, sep = "")
    EOLEOL_size = bytesize(EOLEOL)
    EOLEOL_raw = charToRaw(EOLEOL)
    buf = new.env(parent = emptyenv())
    buf$bufsize = 16384L
    buf$read_buffer = input$read(boundaryEOL_size)
    buf$read_buffer_len = length(buf$read_buffer)
    buf$unread = content_length - boundary_size
    if (!identical(boundaryEOL_raw, buf$read_buffer)) {
        warning("bad content body")
        input$rewind()
        return()
    }
    fill_buffer = function() {
        x = input$read(min(buf$bufsize, buf$unread))
        n = length(x)
        if (n == 0L) 
            return()
        buf$read_buffer = c(buf$read_buffer, x)
        buf$read_buffer_len = length(buf$read_buffer)
        buf$unread = buf$unread - n
    }
    slice_buffer = function(i, size) {
        slice = buf$read_buffer[if (i > 1) 
            1:(i - 1)
        else 1]
        buf$read_buffer = if (size < buf$read_buffer_len) 
            buf$read_buffer[(i + size):buf$read_buffer_len]
        else raw()
        buf$read_buffer_len = length(buf$read_buffer)
        slice
    }
    buf$read_buffer = raw()
    fill_buffer()
    raw_match = function(x1, x2) {
        if (is.character(x1)) 
            x1 = charToRaw(x1)
        .Call("rawmatch", x1, x2, PACKAGE = "mime")
    }
    unescape = function(x) {
        unlist(lapply(x, function(s) utils::URLdecode(chartr("+", 
            " ", s))))
    }
    while (TRUE) {
        head = value = NULL
        filename = content_type = name = NULL
        while (is.null(head)) {
            i = raw_match(EOLEOL_raw, buf$read_buffer)
            if (length(i)) {
                head = slice_buffer(i, EOLEOL_size)
                break
            }
            else if (buf$unread) {
                fill_buffer()
            }
            else {
                break
            }
        }
        if (is.null(head)) {
            warning("Bad post payload: searching for a header")
            input$rewind()
            return()
        }
        head = rawToChar(head)
        token = "[^\\s()<>,;:\\\"\\/\\[\\]?=]+"
        condisp = sprintf("Content-Disposition:\\s*%s\\s*", token)
        dispparm = sprintf(";\\s*(%s)=(\"(?:\\\"|[^\"])*\"|%s)*", 
            token, token)
        rfc2183 = sprintf("(?m)^%s(%s)+$", condisp, dispparm)
        broken_quoted = sprintf("(?m)^%s.*;\\sfilename=\"(.*?)\"(?:\\s*$|\\s*;\\s*%s=)", 
            condisp, token)
        broken_unquoted = sprintf("(?m)^%s.*;\\sfilename=(%s)", 
            condisp, token)
        if (length(grep(rfc2183, head, perl = TRUE))) {
            first_line = sub(condisp, "", strsplit(head, EOL)[[1L]][1], 
                perl = TRUE)
            pairs = strsplit(first_line, ";", fixed = TRUE)[[1L]]
            fnmatch = "\\s*filename=(.*)\\s*"
            if (any(grepl(fnmatch, pairs, perl = TRUE))) {
                filename = pairs[grepl(fnmatch, pairs, perl = TRUE)][1]
                filename = gsub("\"", "", sub(fnmatch, "\\1", 
                  filename, perl = TRUE))
            }
        }
        else if (length(grep(broken_quoted, head, perl = TRUE))) {
            filename = sub(broken_quoted, "\\1", strsplit(head, 
                "\r\n")[[1L]][1], perl = TRUE)
        }
        else if (length(grep(broken_unquoted, head, perl = TRUE))) {
            filename = sub(broken_unquoted, "\\1", strsplit(head, 
                "\r\n")[[1L]][1], perl = TRUE)
        }
        headlines = strsplit(head, EOL, fixed = TRUE)[[1L]]
        content_type_re = "(?mi)Content-Type: (.*)"
        content_types = grep(content_type_re, headlines, perl = TRUE, 
            value = TRUE)
        if (length(content_types)) {
            content_type = sub(content_type_re, "\\1", content_types[1], 
                perl = TRUE)
        }
        name = sub("(?si)Content-Disposition:.*\\s+name=\"?([^\";]*).*\"?", 
            "\\1", head, perl = TRUE)
        while (TRUE) {
            i = raw_match(boundary, buf$read_buffer)
            if (length(i)) {
                value = slice_buffer(i, boundary_size)
                if (identical(tail(value, EOL_size), EOL_raw)) 
                  value = head(value, -EOL_size)
                if (length(value)) {
                  if (identical(value, EOL_raw)) 
                    break
                  if (!is.null(filename) || !is.null(content_type)) {
                    data = list()
                    data$name = if (is.null(filename)) 
                      NA_character_
                    else filename
                    data$size = length(value)
                    data$type = if (is.null(content_type)) 
                      NA_character_
                    else content_type
                    data$datapath = tempfile()
                    con = file(data$datapath, open = "wb")
                    tryCatch(writeBin(value, con), finally = close(con))
                    params[[name]] = rbind(params[[name]], as.data.frame(data, 
                      stringsAsFactors = FALSE))
                  }
                  else {
                    len = length(value)
                    if (len > 2 && length(raw_match(EOL, value[(len - 
                      1):len]))) 
                      len = len - 2
                    paramValue = rawToChar(value[1:len])
                    paramSet = FALSE
                    if (grepl("\\[\\]$", name)) {
                      name = sub("\\[\\]$", "", name)
                      if (name %in% names(params)) {
                        params[[name]] = c(params[[name]], paramValue)
                        paramSet = TRUE
                      }
                    }
                    if (!paramSet) 
                      params[[name]] = paramValue
                  }
                }
                break
            }
            else if (buf$unread) {
                fill_buffer()
            }
            else {
                break
            }
        }
        if (is.null(value)) {
            input$rewind()
            warning("Bad post payload: searching for a body part")
            return(NULL)
        }
        while (buf$read_buffer_len < 2 && buf$unread) fill_buffer()
        if (buf$read_buffer_len < 2 && buf$unread == 0) {
            input$rewind()
            return(params)
        }
        if (length(raw_match("--", buf$read_buffer[1:2]))) {
            input$rewind()
            return(params)
        }
        if (length(raw_match(EOL, buf$read_buffer[1:EOL_size]))) {
            slice_buffer(1, EOL_size)
        }
        else {
            warning("Bad post body: EOL not present")
            input$rewind()
            return(params)
        }
        if ((buf$read_buffer_len + buf$unread) < boundary_size) {
            warning("Bad post body: unknown trailing bytes")
            input$rewind()
            return(params)
        }
    }
}




## Package Data

# none


## Package Info

.skeleton_package_title = "Map Filenames to MIME Types"

.skeleton_package_version = "0.5"

.skeleton_package_depends = ""

.skeleton_package_imports = "tools"


## Internal

.skeleton_version = 5


## EOF